<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Windows Theme Spoofing | My blog</title><meta name=keywords content><meta name=description content="This challenge is marked as HARD by LetsDefend: https://app.letsdefend.io/challenge/windows-theme-spoofing
We use a combination of Wireshark and MFT Viewer to analyze the investigation files using DFIR methods.
Windows Theme Spoofing
For more information on the vulnerability we&rsquo;ll be inspecting: https://www.rbtsec.com/blog/cve-2024-21320-windows-themes-spoofing-vulnerability-walkthrough/
This CVE-2024-21320 exploit involves a malicious Windows theme that triggers NTLM hash disclosure without user interaction. The analysis is conducted using the following steps.
Can you identify the Attacker&rsquo;s file share path utilized to exploit the CVE?
"><meta name=author content="map[hidefooter:true name:Reece Burke]"><link rel=canonical href=https://isuquo.github.io/posts/windows-theme-spoofing/><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://isuquo.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://isuquo.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://isuquo.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://isuquo.github.io/apple-touch-icon.png><link rel=mask-icon href=https://isuquo.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://isuquo.github.io/posts/windows-theme-spoofing/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://isuquo.github.io/posts/windows-theme-spoofing/"><meta property="og:site_name" content="My blog"><meta property="og:title" content="Windows Theme Spoofing"><meta property="og:description" content="This challenge is marked as HARD by LetsDefend: https://app.letsdefend.io/challenge/windows-theme-spoofing
We use a combination of Wireshark and MFT Viewer to analyze the investigation files using DFIR methods.
Windows Theme Spoofing For more information on the vulnerability we’ll be inspecting: https://www.rbtsec.com/blog/cve-2024-21320-windows-themes-spoofing-vulnerability-walkthrough/
This CVE-2024-21320 exploit involves a malicious Windows theme that triggers NTLM hash disclosure without user interaction. The analysis is conducted using the following steps.
Can you identify the Attacker’s file share path utilized to exploit the CVE? "><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-06-07T00:00:00+00:00"><meta property="article:modified_time" content="2025-06-07T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Windows Theme Spoofing"><meta name=twitter:description content="This challenge is marked as HARD by LetsDefend: https://app.letsdefend.io/challenge/windows-theme-spoofing
We use a combination of Wireshark and MFT Viewer to analyze the investigation files using DFIR methods.
Windows Theme Spoofing
For more information on the vulnerability we&rsquo;ll be inspecting: https://www.rbtsec.com/blog/cve-2024-21320-windows-themes-spoofing-vulnerability-walkthrough/
This CVE-2024-21320 exploit involves a malicious Windows theme that triggers NTLM hash disclosure without user interaction. The analysis is conducted using the following steps.
Can you identify the Attacker&rsquo;s file share path utilized to exploit the CVE?
"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://isuquo.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Windows Theme Spoofing","item":"https://isuquo.github.io/posts/windows-theme-spoofing/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Windows Theme Spoofing","name":"Windows Theme Spoofing","description":"This challenge is marked as HARD by LetsDefend: https://app.letsdefend.io/challenge/windows-theme-spoofing\nWe use a combination of Wireshark and MFT Viewer to analyze the investigation files using DFIR methods.\nWindows Theme Spoofing For more information on the vulnerability we\u0026rsquo;ll be inspecting: https://www.rbtsec.com/blog/cve-2024-21320-windows-themes-spoofing-vulnerability-walkthrough/\nThis CVE-2024-21320 exploit involves a malicious Windows theme that triggers NTLM hash disclosure without user interaction. The analysis is conducted using the following steps.\nCan you identify the Attacker\u0026rsquo;s file share path utilized to exploit the CVE? ","keywords":[],"articleBody":"This challenge is marked as HARD by LetsDefend: https://app.letsdefend.io/challenge/windows-theme-spoofing\nWe use a combination of Wireshark and MFT Viewer to analyze the investigation files using DFIR methods.\nWindows Theme Spoofing For more information on the vulnerability we’ll be inspecting: https://www.rbtsec.com/blog/cve-2024-21320-windows-themes-spoofing-vulnerability-walkthrough/\nThis CVE-2024-21320 exploit involves a malicious Windows theme that triggers NTLM hash disclosure without user interaction. The analysis is conducted using the following steps.\nCan you identify the Attacker’s file share path utilized to exploit the CVE? The attacker’s file share path is identified through Wireshark packet analysis of SMB traffic related to the theme file.\nVictim’s NTLM hash was relayed to the attacker’s server allowing them to capture the hash and either use it in NTLM relay attacks or crack the hash. What is the Full Username of the compromised account? Same screenshot as above\nThe full username of the compromised account is determined from the NTLM authentication details in the Wireshark capture.\nThe victim’s credentials were relayed to attackers 3 times. Considering only the packets related to the first relay, what is the NTLM Server challenge used in the NTLM negotiation? The NTLM Server Challenge for the first relay is extracted from the relevant packet in the Wireshark capture. This challenge is a random value generated by the server to secure the NTLM authentication process.\nWhat is the NTProofStr value in the NTLM negotiation? As above, next packet in the request\nThe NTProofStr value is obtained from the subsequent packet following the NTLM Server Challenge in the Wireshark capture. NTProofStr, or NT Proof String, is a hashed response generated by the client using the NTLM Server Challenge and the user’s password hash see Microsoft documentation on NTLM. It serves as proof of the client’s knowledge of the password, enabling the server to verify authenticity without transmitting the password in plaintext.\nSecurity team saw an RDP connection from the Attacker’s internal machine to the compromised victim’s machine, a day after the CVE was exploited. When did the attacker log on successfully? The successful RDP logon time is identified from the security event logs, specifically event 4624, recorded a day after the exploit.\nTracing back to the start of the exploitation, what was the name of the file used to exploit the victim and exploit the CVE. Please detail the full path of the file. The file used to exploit the victim is traced using MFT Viewer, with the full path determined from the file system analysis.\nAttacker downloaded a Powershell script on the system, to further their objectives. What is the name of the script? Search for .ps1\nThe name of the PowerShell script is identified by filtering event logs for .ps1 files, using a 4104 event code search.\nAttacker Added a backdoor account for persistence mechanisms. What is the username and password of the newly created account? Auditing for Account Management not enabled. Security logs show no 4720 events.\nThe attacker gained access around 2024-03-14 06:55.\nTherefore, analysis shifts to other event logs following the initial access.\nReview of PowerShell event logs (4104) after the incident timeline indicates the attacker executed a command to create a new user account.\n","wordCount":"520","inLanguage":"en","datePublished":"2025-06-07T00:00:00Z","dateModified":"2025-06-07T00:00:00Z","author":{"@type":"Person","name":{"hidefooter":true,"name":"Reece Burke"}},"mainEntityOfPage":{"@type":"WebPage","@id":"https://isuquo.github.io/posts/windows-theme-spoofing/"},"publisher":{"@type":"Organization","name":"My blog","logo":{"@type":"ImageObject","url":"https://isuquo.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://isuquo.github.io/ accesskey=h title="My blog (Alt + H)">My blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Windows Theme Spoofing</h1><div class=post-meta><span title='2025-06-07 00:00:00 +0000 UTC'>June 7, 2025</span>&nbsp;·&nbsp;map[hidefooter:true name:Reece Burke]</div></header><div class=post-content><p>This challenge is marked as HARD by LetsDefend: <a href=https://app.letsdefend.io/challenge/windows-theme-spoofing>https://app.letsdefend.io/challenge/windows-theme-spoofing</a></p><p>We use a combination of Wireshark and MFT Viewer to analyze the investigation files using DFIR methods.</p><h1 id=windows-theme-spoofing>Windows Theme Spoofing<a hidden class=anchor aria-hidden=true href=#windows-theme-spoofing>#</a></h1><p>For more information on the vulnerability we&rsquo;ll be inspecting: <a href=https://www.rbtsec.com/blog/cve-2024-21320-windows-themes-spoofing-vulnerability-walkthrough/>https://www.rbtsec.com/blog/cve-2024-21320-windows-themes-spoofing-vulnerability-walkthrough/</a></p><p>This CVE-2024-21320 exploit involves a malicious Windows theme that triggers NTLM hash disclosure without user interaction. The analysis is conducted using the following steps.</p><h2 id=can-you-identify-the-attackers-file-share-path-utilized-to-exploit-the-cve>Can you identify the Attacker&rsquo;s file share path utilized to exploit the CVE?<a hidden class=anchor aria-hidden=true href=#can-you-identify-the-attackers-file-share-path-utilized-to-exploit-the-cve>#</a></h2><p><img loading=lazy src=/posts/windows-theme-spoofing/images/1.png></p><p>The attacker’s file share path is identified through Wireshark packet analysis of SMB traffic related to the theme file.</p><h2 id=victims-ntlm-hash-was-relayed-to-the-attackers-server-allowing-them-to-capture-the-hash-and-either-use-it-in-ntlm-relay-attacks-or-crack-the-hash-what-is-the-full-username-of-the-compromised-account>Victim&rsquo;s NTLM hash was relayed to the attacker&rsquo;s server allowing them to capture the hash and either use it in NTLM relay attacks or crack the hash. What is the Full Username of the compromised account?<a hidden class=anchor aria-hidden=true href=#victims-ntlm-hash-was-relayed-to-the-attackers-server-allowing-them-to-capture-the-hash-and-either-use-it-in-ntlm-relay-attacks-or-crack-the-hash-what-is-the-full-username-of-the-compromised-account>#</a></h2><p>Same screenshot as above</p><p>The full username of the compromised account is determined from the NTLM authentication details in the Wireshark capture.</p><h2 id=the-victims-credentials-were-relayed-to-attackers-3-times-considering-only-the-packets-related-to-the-first-relay-what-is-the-ntlm-server-challenge-used-in-the-ntlm-negotiation>The victim&rsquo;s credentials were relayed to attackers 3 times. Considering only the packets related to the first relay, what is the NTLM Server challenge used in the NTLM negotiation?<a hidden class=anchor aria-hidden=true href=#the-victims-credentials-were-relayed-to-attackers-3-times-considering-only-the-packets-related-to-the-first-relay-what-is-the-ntlm-server-challenge-used-in-the-ntlm-negotiation>#</a></h2><p><img loading=lazy src=2.png></p><p>The NTLM Server Challenge for the first relay is extracted from the relevant packet in the Wireshark capture. This challenge is a random value generated by the server to secure the NTLM authentication process.</p><h2 id=what-is-the-ntproofstr-value-in-the-ntlm-negotiation>What is the NTProofStr value in the NTLM negotiation?<a hidden class=anchor aria-hidden=true href=#what-is-the-ntproofstr-value-in-the-ntlm-negotiation>#</a></h2><p>As above, next packet in the request</p><p>The NTProofStr value is obtained from the subsequent packet following the NTLM Server Challenge in the Wireshark capture. NTProofStr, or NT Proof String, is a hashed response generated by the client using the NTLM Server Challenge and the user’s password hash <a href=https://docs.microsoft.com/en-us/windows/win32/secauthn/microsoft-ntlm>see Microsoft documentation on NTLM</a>. It serves as proof of the client’s knowledge of the password, enabling the server to verify authenticity without transmitting the password in plaintext.</p><h2 id=security-team-saw-an-rdp-connection-from-the-attackers-internal-machine-to-the-compromised-victims-machine-a-day-after-the-cve-was-exploited-when-did-the-attacker-log-on-successfully>Security team saw an RDP connection from the Attacker&rsquo;s internal machine to the compromised victim&rsquo;s machine, a day after the CVE was exploited. When did the attacker log on successfully?<a hidden class=anchor aria-hidden=true href=#security-team-saw-an-rdp-connection-from-the-attackers-internal-machine-to-the-compromised-victims-machine-a-day-after-the-cve-was-exploited-when-did-the-attacker-log-on-successfully>#</a></h2><p><img loading=lazy src=3.png>
<img loading=lazy src=4.png></p><p>The successful RDP logon time is identified from the security event logs, specifically event 4624, recorded a day after the exploit.</p><h2 id=tracing-back-to-the-start-of-the-exploitation-what-was-the-name-of-the-file-used-to-exploit-the-victim-and-exploit-the-cve-please-detail-the-full-path-of-the-file>Tracing back to the start of the exploitation, what was the name of the file used to exploit the victim and exploit the CVE. Please detail the full path of the file.<a hidden class=anchor aria-hidden=true href=#tracing-back-to-the-start-of-the-exploitation-what-was-the-name-of-the-file-used-to-exploit-the-victim-and-exploit-the-cve-please-detail-the-full-path-of-the-file>#</a></h2><p><img loading=lazy src=5.png></p><p>The file used to exploit the victim is traced using MFT Viewer, with the full path determined from the file system analysis.</p><h2 id=attacker-downloaded-a-powershell-script-on-the-system-to-further-their-objectives-what-is-the-name-of-the-script>Attacker downloaded a Powershell script on the system, to further their objectives. What is the name of the script?<a hidden class=anchor aria-hidden=true href=#attacker-downloaded-a-powershell-script-on-the-system-to-further-their-objectives-what-is-the-name-of-the-script>#</a></h2><p>Search for .ps1</p><p>The name of the PowerShell script is identified by filtering event logs for .ps1 files, using a 4104 event code search.</p><h2 id=attacker-added-a-backdoor-account-for-persistence-mechanisms-what-is-the-username-and-password-of-the-newly-created-account>Attacker Added a backdoor account for persistence mechanisms. What is the username and password of the newly created account?<a hidden class=anchor aria-hidden=true href=#attacker-added-a-backdoor-account-for-persistence-mechanisms-what-is-the-username-and-password-of-the-newly-created-account>#</a></h2><p>Auditing for Account Management not enabled. Security logs show no 4720 events.</p><p>The attacker gained access around 2024-03-14 06:55.</p><p>Therefore, analysis shifts to other event logs following the initial access.</p><p>Review of PowerShell event logs (4104) after the incident timeline indicates the attacker executed a command to create a new user account.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://isuquo.github.io/>My blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>