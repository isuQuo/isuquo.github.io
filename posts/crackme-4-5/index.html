<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>Crackme challenge #4 & #5 | My blog</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Today we&rsquo;ll be looking at two ringzer0 Reverse Engineering challenges called &ldquo;Windows x86 reversing is cool&rdquo; and &ldquo;Windows API for the win&rdquo;. Both challenges are worth 3 and 4 points respectively.
The goal of the challenges is to find the flag hidden within.
Windows x86 reversing is cool
When executing the application, it asks for a key. Typing in &ldquo;1234&rdquo; yields a &ldquo;Wrong Key!&rdquo; string:

Static analysis:
Analysing the exe in IDA, we can see the key function is found at address 0x40139B. We can also see our &ldquo;Wrong Key!&rdquo; string in here."><meta name=generator content="Hugo 0.147.8"><meta name=robots content="index, follow"><link rel=stylesheet href=/ananke/css/main.min.8d048772ae72ab11245a0e296d1f2a36d3e3dd376c6c867394d6cc659c68fc37.css><link rel=canonical href=https://isuquo.github.io/posts/crackme-4-5/><meta property="og:url" content="https://isuquo.github.io/posts/crackme-4-5/"><meta property="og:site_name" content="My blog"><meta property="og:title" content="Crackme challenge #4 & #5"><meta property="og:description" content="Today we’ll be looking at two ringzer0 Reverse Engineering challenges called “Windows x86 reversing is cool” and “Windows API for the win”. Both challenges are worth 3 and 4 points respectively.
The goal of the challenges is to find the flag hidden within.
Windows x86 reversing is cool When executing the application, it asks for a key. Typing in “1234” yields a “Wrong Key!” string:
Static analysis: Analysing the exe in IDA, we can see the key function is found at address 0x40139B. We can also see our “Wrong Key!” string in here."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-12-01T00:00:00+00:00"><meta property="article:modified_time" content="2019-12-01T00:00:00+00:00"><meta itemprop=name content="Crackme challenge #4 & #5"><meta itemprop=description content="Today we’ll be looking at two ringzer0 Reverse Engineering challenges called “Windows x86 reversing is cool” and “Windows API for the win”. Both challenges are worth 3 and 4 points respectively.
The goal of the challenges is to find the flag hidden within.
Windows x86 reversing is cool When executing the application, it asks for a key. Typing in “1234” yields a “Wrong Key!” string:
Static analysis: Analysing the exe in IDA, we can see the key function is found at address 0x40139B. We can also see our “Wrong Key!” string in here."><meta itemprop=datePublished content="2019-12-01T00:00:00+00:00"><meta itemprop=dateModified content="2019-12-01T00:00:00+00:00"><meta itemprop=wordCount content="1136"><meta name=twitter:card content="summary"><meta name=twitter:title content="Crackme challenge #4 & #5"><meta name=twitter:description content="Today we’ll be looking at two ringzer0 Reverse Engineering challenges called “Windows x86 reversing is cool” and “Windows API for the win”. Both challenges are worth 3 and 4 points respectively.
The goal of the challenges is to find the flag hidden within.
Windows x86 reversing is cool When executing the application, it asks for a key. Typing in “1234” yields a “Wrong Key!” string:
Static analysis: Analysing the exe in IDA, we can see the key function is found at address 0x40139B. We can also see our “Wrong Key!” string in here."></head><body class="ma0 avenir bg-near-white production"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l center items-center justify-between"><a href=/ class="f3 fw2 hover-white white-90 dib no-underline">My blog</a><div class="flex-l items-center"><div class=ananke-socials></div></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l mw8 center ph3 flex-wrap justify-between"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked ttu">Posts</aside><div id=sharing class="mt3 ananke-socials"></div><h1 class="f1 athelas mt3 mb1">Crackme challenge #4 & #5</h1><time class="f6 mv4 dib tracked" datetime=2019-12-01T00:00:00Z>December 1, 2019</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>Today we&rsquo;ll be looking at two ringzer0 Reverse Engineering challenges called &ldquo;Windows x86 reversing is cool&rdquo; and &ldquo;Windows API for the win&rdquo;. Both challenges are worth 3 and 4 points respectively.</p><p>The goal of the challenges is to find the flag hidden within.</p><h1 id=windows-x86-reversing-is-cool>Windows x86 reversing is cool</h1><p>When executing the application, it asks for a key. Typing in &ldquo;1234&rdquo; yields a &ldquo;Wrong Key!&rdquo; string:</p><p><img src=images/1.PNG alt></p><h2 id=static-analysis>Static analysis:</h2><p>Analysing the exe in IDA, we can see the key function is found at address 0x40139B. We can also see our &ldquo;Wrong Key!&rdquo; string in here.</p><p><img src=images/2.PNG alt></p><p>As above, it looks like our key will need to be at a length of 6 otherwise &ldquo;Wrong Key!&rdquo; is returned.</p><p><img src=images/3.PNG alt></p><p>If our key is 6 characters long, we run into another function that takes our input and XORs the input with 0xFFFFFFD3. At the end before the jump, we can see a compare against our key and the key it is expecting.</p><p>We can use Ollydbg to debug this function and find out what it is expecting.</p><h2 id=dynamic-analysis>Dynamic analysis:</h2><p>We can find all referenced strings and quickly jump to the address our &ldquo;Wrong Key!&rdquo; string is found at.</p><p>We set a breakpoint at the beginning of the function in the previous function. We punch in our key as &ldquo;123456&rdquo;:</p><p><img src=images/4.PNG alt></p><p>Beforehand, EBP-1C was set to 0, so both EAX and EDX registers are set to 0. The first byte of our key is placed into DL. The EDX register is XOR&rsquo;d with 0xFFFFFFD3 and returns 0xFFFFFFE2. DL is then placed into the first byte of our key, essentially replacing &ldquo;1&rdquo; (0x31) with 0xE2.</p><p>We can see in the next screenshot that a byte from the address found at EBP+EAX-423 (0x28FAF5) is moved into the AL register, where it is then compared against our DL register.</p><p><img src=images/5.PNG alt></p><p>Looping through this function, we find that it is comparing against the following values, 0x97, 0xE0, 0xEB, 0xA0, 0xB8, 0xEL, respectively.</p><p>I have created a small Python script to simulate the function to find out the exact combination of characters we need to input to hopefully crack the program:</p><pre tabindex=0><code>import string

key = 0xFFFFFFD3

for s in string.printable:
 result = int(hex(ord(s)), 16) ^ int(hex(key), 16)
 dl = str(hex(result))[-2:]
 if dl == &#39;97&#39;:
  print(&#39;97&#39;, s)
 if dl == &#39;e0&#39;:
  print(&#39;e0&#39;, s)
 if dl == &#39;eb&#39;:
  print(&#39;eb&#39;, s)
 if dl == &#39;a0&#39;:
  print(&#39;a0&#39;, s)
 if dl == &#39;b8&#39;:
  print(&#39;b8&#39;, s)
 if dl == &#39;e1&#39;:
  print(&#39;e1&#39;, s)
</code></pre><p>After running the script, we find the correct combination is &ldquo;D38sk2&rdquo;, let&rsquo;s try that:</p><p><img src=images/6.PNG alt></p><p>Hoorah!</p><h1 id=windows-api-for-the-win>Windows API for the win</h1><p>This challenge is much like the other one, it asks for a password and if wrong, returns &ldquo;Wrong password!&rdquo;.</p><h2 id=static-analysis-1>Static analysis:</h2><p>Nothing valuable is found in the strings other than the &ldquo;Wrong password!&rdquo; we&rsquo;ve already come across, again, much like the previous challenge.</p><p>If we double click on the &ldquo;Wrong password!&rdquo; string, we are taken to what looks like the password function we&rsquo;re after, located at address 0x4014C9.</p><p>The following screenshot takes our password and runs through a bunch of functions that don&rsquo;t appear to do much. After each function call, the EAX register is reset back to the return value of GlobalAlloc. At the end of the function, a call to strlen is made, comparing our password to a length of 6 characters.</p><p>Amongst the function calls is a call to IsDebuggerPresent, but it does not matter as the return value is not used for anything. This is most likely a ploy to distract the reverser.</p><p><img src=images/7.PNG alt></p><p>If our password is 6 characters long, we need to run through a second function that needs a little attention to determine what it is doing.</p><p><img src=images/8.PNG alt></p><p>Starting from the top, the first byte of our password is moved into the DL register. var_1C was set to the return value of GlobalAlloc, and that is moved into EAX. A byte from EAX is moved into AL and EAX and EDX are XOR&rsquo;d against each other. At this point, we don&rsquo;t know what EDX is set to. AL is then moved into the first byte of our password.</p><p>The same trend continues for each byte in our password. At the end of the function, we can see a call to strcmp. Let&rsquo;s see if we can find out what the program is expecting by stepping through the above function.</p><h2 id=dynamic-analysis-1>Dynamic analysis:</h2><p>We can find all referenced strings and quickly jump to the function where our &ldquo;Wrong password!&rdquo; string is found.</p><p>After we step through the call to scanf, we enter in our password as &ldquo;123456&rdquo;. As mentioned above from our IDA analysis, the first byte of our password is moved into DL. Stepping through the function, we can see that 0x08 is our mystery byte that is moved into AL. EAX and EDX are XOR&rsquo;d against each other, and AL is moved into the first byte of our password.</p><p>In summary:</p><ol><li>Take first byte of password, put into dl</li><li>Move 08 into al</li><li>XOR eax, edx</li><li>Move al into first byte of password</li></ol><p>For each consecutive byte of our password, C8 18 28 B8 E8 are moved into AL at step 2. For step 4, we can observe that 0x3B is moved into the first byte of our password.</p><p>At the end of the function before the call to strcmp, we can see the outcome of each byte of our password:</p><p><img src=images/9.PNG alt></p><p>As these are not printable characters, if we were to create a script, how would be know what to be looking for? If we copy and paste them into Notepad, it is a little better:</p><p><img src=images/10.PNG alt></p><p>However, it would be quite difficult to create a script as we also need to know what the EDX register is set to for step 3. Going back through the instructions, I found EDX is set by a call to strlen. We simply need to find a better way.</p><p>If you take a look at the screenshot where we can see our non-printable characters the program has calculated, in the instructions, we can see the address where the non-printable characters are located at is loaded into EAX and then moved onto the stack. The same is done for our password (after step 4). They obviously don&rsquo;t match.</p><p>If we continue stepping, we get to the instruction that jumps us to the &ldquo;Wrong password!&rdquo; area. If we alter the zero flag to trick the program into thinking our passwords matched, we come across to another instruction that takes the password and loads it into EAX at address 0x401626.</p><p>What if we changed the instruction to instead load the address of the password that the program is actually looking for? As with a couple of screenshots up at address 0x40160D, this address is located at EBP-23.</p><p><img src=images/11.PNG alt></p><p>After we step over the modified instruction, let&rsquo;s see what happens when we execute the rest of the program:</p><p><img src=images/12.PNG alt></p><ul class=pa0></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href=https://isuquo.github.io/>&copy; My blog 2025</a><div><div class=ananke-socials></div></div></div></footer></body></html>