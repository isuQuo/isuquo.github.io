<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Windows Forensics | My blog</title><meta name=keywords content><meta name=description content="This challenge involves analyzing a scenario of lateral movement and persistence following initial access.
We use various DFIR tools to examine the investigation files.
The challenge is marked as HARD by LetsDefend: https://app.letsdefend.io/challenge/windows-forensics
Windows Forensics
Initial Access was made through a Malicious Document delivered through email. What was the full path where the document was downloaded?
Trouble exporting files as is.
Needed to mount the drive to a logical disk to view the [root] directory."><meta name=author content="map[hidefooter:true name:Reece Burke]"><link rel=canonical href=https://isuquo.github.io/posts/windows-forensics/><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://isuquo.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://isuquo.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://isuquo.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://isuquo.github.io/apple-touch-icon.png><link rel=mask-icon href=https://isuquo.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://isuquo.github.io/posts/windows-forensics/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://isuquo.github.io/posts/windows-forensics/"><meta property="og:site_name" content="My blog"><meta property="og:title" content="Windows Forensics"><meta property="og:description" content="This challenge involves analyzing a scenario of lateral movement and persistence following initial access.
We use various DFIR tools to examine the investigation files.
The challenge is marked as HARD by LetsDefend: https://app.letsdefend.io/challenge/windows-forensics
Windows Forensics Initial Access was made through a Malicious Document delivered through email. What was the full path where the document was downloaded? Trouble exporting files as is.
Needed to mount the drive to a logical disk to view the [root] directory."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-06-08T00:00:00+00:00"><meta property="article:modified_time" content="2025-06-08T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Windows Forensics"><meta name=twitter:description content="This challenge involves analyzing a scenario of lateral movement and persistence following initial access.
We use various DFIR tools to examine the investigation files.
The challenge is marked as HARD by LetsDefend: https://app.letsdefend.io/challenge/windows-forensics
Windows Forensics
Initial Access was made through a Malicious Document delivered through email. What was the full path where the document was downloaded?
Trouble exporting files as is.
Needed to mount the drive to a logical disk to view the [root] directory."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://isuquo.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Windows Forensics","item":"https://isuquo.github.io/posts/windows-forensics/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Windows Forensics","name":"Windows Forensics","description":"This challenge involves analyzing a scenario of lateral movement and persistence following initial access.\nWe use various DFIR tools to examine the investigation files.\nThe challenge is marked as HARD by LetsDefend: https://app.letsdefend.io/challenge/windows-forensics\nWindows Forensics Initial Access was made through a Malicious Document delivered through email. What was the full path where the document was downloaded? Trouble exporting files as is.\nNeeded to mount the drive to a logical disk to view the [root] directory.\n","keywords":[],"articleBody":"This challenge involves analyzing a scenario of lateral movement and persistence following initial access.\nWe use various DFIR tools to examine the investigation files.\nThe challenge is marked as HARD by LetsDefend: https://app.letsdefend.io/challenge/windows-forensics\nWindows Forensics Initial Access was made through a Malicious Document delivered through email. What was the full path where the document was downloaded? Trouble exporting files as is.\nNeeded to mount the drive to a logical disk to view the [root] directory.\nNo downloads folder. Need to look elsewhere.\nThe full path is determined by mounting the drive and analyzing the file system. The absence of a Downloads folder suggests the document was stored in an alternative location.\nShellbagsExplorer UsrClass.dat UsrClass.dat is a registry hive file located in C:\\Users\\\\NTUSER.DAT\\Classes that stores user-specific shell settings, including folder views and recently accessed directories. ShellbagsExplorer is used to parse this file to reconstruct user activity, such as file access locations see Microsoft documentation on registry hives.\nWhat’s the document name? (The document which was delivered via phishing) We know it’s in the Downloads folder. There is no downloads folder in the retrieved files.\nI saw this before:\nWe can use Eric Zimmerman’s RBCmd\nRBCmd.exe -f $IWKWHDC.docx\nIt prints the original file name, and the file was deleted on 2022-08-21 13:03:33.\nThe document name is extracted using RBCmd, which recovers the original filename from the Recycle Bin metadata. The deletion timestamp indicates when it was removed.\nWhat’s the stager name which connected to the attacker C2 server (Full path\\name) Given the deletion time of the document file, we can navigate to the Prefetch directory within FTK Imager to understand what programs were executing around that time. Sort by date modified.\nWe can use PEcmd.exe for more info on this exe\nAfter running PEcmd.exe -f SECURITYPATCH.EXE-3B79B19E.pf\nWe can see the original directory this executable was found in.\nThe stager executable is identified through Prefetch data, with PEcmd providing the original directory and filename from the prefetch file.\nThe attacker manipulated MACB Timestamps of the stager executable to confuse Analysts. Analyze the timestamps of the stager and verify the original timestamp and tampered one. (ORIGINAL TIMESTAMP : TAMPERED TIMESTAMP) Found this on MACB Timestamps: https://cscclabs.medium.com/mac-b-timestamps-86b40d7e7144\nDifference between $STANDARD_INFO \u0026 $FILE_NAME:\n$STANDARD_INFO can be modified by user level processes. $FILE_NAME can only be modified by the system kernel. There are no known anti-forensics tools that can modify this.\nWe can explore the MFT file for more information on this file.\npython analyzeMFT.py -f $MFT -o output.csv\nAfter searching for the exe in Notepad++, we can see the original creation time.\nMy answer was still wrong.\nLooking back on the previously linked article, there is a STD (Standard) and FN (File Name) variable I need to pay attention to.\nReviewing the MFT output, I was looking at the wrong field (Standard) instead of File Name.\nThe tampered time is the STD, which again, can be altered by user level processes. The original creation time is found in the FN Info Creation Date field.\nTimestamps are analyzed using the MFT file, comparing the $STANDARD_INFO (tampered) and $FILE_NAME (original) attributes to identify discrepancies.\nThe attacker set up persistence by manipulating registry keys. All we know is that GlobalFlags image file technique was used to set up persistence. When exiting a certain process, the attacker persistence executable is executed. What’s the name of that process? https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/gflags-details\nSetting GlobalFlags involves configuring the Windows Global Flag registry settings, typically under HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager, to enable debugging or monitoring features. In this context, it is used with the Silent Process Exit (SPE) mechanism to execute a persistence executable when a monitored process exits see Microsoft documentation on GFlags.\nWhats the full path alongside name of the executable which is setup for persistence? (FULLPATH\\Filename) https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/registry-entries-for-silent-process-exit\nBeginning with Windows 7, you can use the Silent Process Exit tab in GFlags to enter the name of a process that you want to monitor for silent exit.\nGlobal settings are stored in the registry under the following key. HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\nThe full path and name of the persistence executable are determined from the registry key HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit.\nThe attacker logged in via RDP and then performed lateral movement. Attacker accessed an Internal network-connected device via RDP. What command was run on cmd after successful RDP into other Windows machine? There are RDP Event logs\nWe can see RDP into 192.168.18.8 at September 8th 2022.\nBut how do we see what command was run on the other machine?\nFound this: https://medium.com/@ronald.craft/blind-forensics-with-the-rdp-bitmap-cache-16e0c202f91c\nThe tool we need to use is bmc-tools.py\nThe cache file can be found in C:\\Users\\\\AppData\\Local\\Microsoft\\Terminal Server Client\\Cache\\\nAfter generating an output with python bmc-tools.py -s cache -d output -b\nWe export 1000+ small BMP images.\nNo tools exist on the machine to piece together the puzzle, so it’s manual work. Eventually, I found a command being run on the command prompt.\nThe command run on the CMD prompt is reconstructed from the RDP bitmap cache using bmc-tools.py, requiring manual analysis of exported BMP images.\nThe attacker tried to download a tool from the user’s browser in that second machine. What’s the tool name? (name.ext) I answered this question, tediously, through the previous method.\nThe tool name is identified through manual analysis of the RDP bitmap cache images generated by bmc-tools.py.\nWhat command was executed which resulted in privilege escalation? When reviewing the SYSTEM event logs, there are no 4688 events, but we can see a peculiar log which registers a service.\nThe command to register a service is cmd.exe /c echo kyvckn \u003e \\\\.\\pipe\\kyvckn\nResearching more on the format of this command and what it’s doing led me to this page: https://bherunda.medium.com/hunting-named-pipe-token-impersonation-abuse-573dcca36ae0\nThe command cmd.exe /c echo kyvckn \u003e \\\\.\\pipe\\kyvckn facilitates privilege escalation through named pipe token impersonation. This technique involves creating a named pipe and using it to impersonate a higher-privileged token, often by exploiting a service or process with elevated rights. The attacker writes to the pipe (kyvckn), allowing them to steal or duplicate the token for unauthorized privilege elevation see details on named pipe impersonation.\nWhat framework was used by the attacker? This command can be used by the Metasploit framework (Meterpreter).\nThe Metasploit framework, specifically the Meterpreter payload, is identified as the likely tool used, given its capability to execute such named pipe commands for privilege escalation.\n","wordCount":"1046","inLanguage":"en","datePublished":"2025-06-08T00:00:00Z","dateModified":"2025-06-08T00:00:00Z","author":{"@type":"Person","name":{"hidefooter":true,"name":"Reece Burke"}},"mainEntityOfPage":{"@type":"WebPage","@id":"https://isuquo.github.io/posts/windows-forensics/"},"publisher":{"@type":"Organization","name":"My blog","logo":{"@type":"ImageObject","url":"https://isuquo.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://isuquo.github.io/ accesskey=h title="My blog (Alt + H)">My blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Windows Forensics</h1><div class=post-meta><span title='2025-06-08 00:00:00 +0000 UTC'>June 8, 2025</span>&nbsp;·&nbsp;map[hidefooter:true name:Reece Burke]</div></header><div class=post-content><p>This challenge involves analyzing a scenario of lateral movement and persistence following initial access.</p><p>We use various DFIR tools to examine the investigation files.</p><p>The challenge is marked as HARD by LetsDefend: <a href=https://app.letsdefend.io/challenge/windows-forensics>https://app.letsdefend.io/challenge/windows-forensics</a></p><h1 id=windows-forensics>Windows Forensics<a hidden class=anchor aria-hidden=true href=#windows-forensics>#</a></h1><h2 id=initial-access-was-made-through-a-malicious-document-delivered-through-email-what-was-the-full-path-where-the-document-was-downloaded>Initial Access was made through a Malicious Document delivered through email. What was the full path where the document was downloaded?<a hidden class=anchor aria-hidden=true href=#initial-access-was-made-through-a-malicious-document-delivered-through-email-what-was-the-full-path-where-the-document-was-downloaded>#</a></h2><p>Trouble exporting files as is.</p><p>Needed to mount the drive to a logical disk to view the [root] directory.</p><p><img loading=lazy src=/posts/windows-forensics/images/1.png></p><p><img loading=lazy src=/posts/windows-forensics/images/2.png></p><p>No downloads folder. Need to look elsewhere.</p><p>The full path is determined by mounting the drive and analyzing the file system. The absence of a Downloads folder suggests the document was stored in an alternative location.</p><h2 id=shellbagsexplorer-usrclassdat>ShellbagsExplorer UsrClass.dat<a hidden class=anchor aria-hidden=true href=#shellbagsexplorer-usrclassdat>#</a></h2><p><img loading=lazy src=/posts/windows-forensics/images/3.png></p><p>UsrClass.dat is a registry hive file located in <code>C:\Users\&lt;Username>\NTUSER.DAT\Classes</code> that stores user-specific shell settings, including folder views and recently accessed directories. ShellbagsExplorer is used to parse this file to reconstruct user activity, such as file access locations <a href=https://docs.microsoft.com/en-us/windows/win32/sysinfo/registry-hives>see Microsoft documentation on registry hives</a>.</p><h2 id=whats-the-document-name-the-document-which-was-delivered-via-phishing>What&rsquo;s the document name? (The document which was delivered via phishing)<a hidden class=anchor aria-hidden=true href=#whats-the-document-name-the-document-which-was-delivered-via-phishing>#</a></h2><p>We know it’s in the Downloads folder. There is no downloads folder in the retrieved files.</p><p>I saw this before:</p><p><img loading=lazy src=/posts/windows-forensics/images/4.png></p><p>We can use Eric Zimmerman&rsquo;s RBCmd</p><p><code>RBCmd.exe -f $IWKWHDC.docx</code></p><p>It prints the original file name, and the file was deleted on <code>2022-08-21 13:03:33</code>.</p><p>The document name is extracted using RBCmd, which recovers the original filename from the Recycle Bin metadata. The deletion timestamp indicates when it was removed.</p><h2 id=whats-the-stager-name-which-connected-to-the-attacker-c2-server-full-pathname>What&rsquo;s the stager name which connected to the attacker C2 server (Full path\name)<a hidden class=anchor aria-hidden=true href=#whats-the-stager-name-which-connected-to-the-attacker-c2-server-full-pathname>#</a></h2><p>Given the deletion time of the document file, we can navigate to the Prefetch directory within FTK Imager to understand what programs were executing around that time. Sort by date modified.</p><p><img loading=lazy src=/posts/windows-forensics/images/5.png></p><p>We can use PEcmd.exe for more info on this exe</p><p>After running <code>PEcmd.exe -f SECURITYPATCH.EXE-3B79B19E.pf</code></p><p>We can see the original directory this executable was found in.</p><p>The stager executable is identified through Prefetch data, with PEcmd providing the original directory and filename from the prefetch file.</p><h2 id=the-attacker-manipulated-macb-timestamps-of-the-stager-executable-to-confuse-analysts-analyze-the-timestamps-of-the-stager-and-verify-the-original-timestamp-and-tampered-one-original-timestamp--tampered-timestamp>The attacker manipulated MACB Timestamps of the stager executable to confuse Analysts. Analyze the timestamps of the stager and verify the original timestamp and tampered one. (ORIGINAL TIMESTAMP : TAMPERED TIMESTAMP)<a hidden class=anchor aria-hidden=true href=#the-attacker-manipulated-macb-timestamps-of-the-stager-executable-to-confuse-analysts-analyze-the-timestamps-of-the-stager-and-verify-the-original-timestamp-and-tampered-one-original-timestamp--tampered-timestamp>#</a></h2><p>Found this on MACB Timestamps: <a href=https://cscclabs.medium.com/mac-b-timestamps-86b40d7e7144>https://cscclabs.medium.com/mac-b-timestamps-86b40d7e7144</a></p><blockquote><p><strong>Difference between $STANDARD_INFO & $FILE_NAME:</strong></p><p>$STANDARD_INFO can be modified by user level processes.
$FILE_NAME can only be modified by the system kernel. There are no known anti-forensics tools that can modify this.</p></blockquote><p>We can explore the MFT file for more information on this file.</p><p><code>python analyzeMFT.py -f $MFT -o output.csv</code></p><p>After searching for the exe in Notepad++, we can see the original creation time.</p><p><img loading=lazy src=/posts/windows-forensics/images/6.png></p><p>My answer was still wrong.</p><p>Looking back on the previously linked article, there is a STD (Standard) and FN (File Name) variable I need to pay attention to.</p><p>Reviewing the MFT output, I was looking at the wrong field (Standard) instead of File Name.</p><p>The tampered time is the STD, which again, can be altered by user level processes. The original creation time is found in the <code>FN Info Creation Date</code> field.</p><p>Timestamps are analyzed using the MFT file, comparing the $STANDARD_INFO (tampered) and $FILE_NAME (original) attributes to identify discrepancies.</p><h2 id=the-attacker-set-up-persistence-by-manipulating-registry-keys-all-we-know-is-that-globalflags-image-file-technique-was-used-to-set-up-persistence-when-exiting-a-certain-process-the-attacker-persistence-executable-is-executed-whats-the-name-of-that-process>The attacker set up persistence by manipulating registry keys. All we know is that GlobalFlags image file technique was used to set up persistence. When exiting a certain process, the attacker persistence executable is executed. What&rsquo;s the name of that process?<a hidden class=anchor aria-hidden=true href=#the-attacker-set-up-persistence-by-manipulating-registry-keys-all-we-know-is-that-globalflags-image-file-technique-was-used-to-set-up-persistence-when-exiting-a-certain-process-the-attacker-persistence-executable-is-executed-whats-the-name-of-that-process>#</a></h2><p><a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/gflags-details>https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/gflags-details</a></p><p><img loading=lazy src=/posts/windows-forensics/images/7.png></p><p><img loading=lazy src=/posts/windows-forensics/images/8.png></p><p>Setting GlobalFlags involves configuring the Windows Global Flag registry settings, typically under <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager</code>, to enable debugging or monitoring features. In this context, it is used with the Silent Process Exit (SPE) mechanism to execute a persistence executable when a monitored process exits <a href=https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/gflags>see Microsoft documentation on GFlags</a>.</p><h2 id=whats-the-full-path-alongside-name-of-the-executable-which-is-setup-for-persistence-fullpathfilename>Whats the full path alongside name of the executable which is setup for persistence? (FULLPATH\Filename)<a hidden class=anchor aria-hidden=true href=#whats-the-full-path-alongside-name-of-the-executable-which-is-setup-for-persistence-fullpathfilename>#</a></h2><p><a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/registry-entries-for-silent-process-exit>https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/registry-entries-for-silent-process-exit</a></p><blockquote><p>Beginning with Windows 7, you can use the <strong>Silent Process Exit</strong> tab in GFlags to enter the name of a process that you want to monitor for silent exit.</p><p>Global settings are stored in the registry under the following key.
<strong>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit</strong></p></blockquote><p><img loading=lazy src=/posts/windows-forensics/images/9.png></p><p>The full path and name of the persistence executable are determined from the registry key <code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit</code>.</p><h2 id=the-attacker-logged-in-via-rdp-and-then-performed-lateral-movement-attacker-accessed-an-internal-network-connected-device-via-rdp-what-command-was-run-on-cmd-after-successful-rdp-into-other-windows-machine>The attacker logged in via RDP and then performed lateral movement. Attacker accessed an Internal network-connected device via RDP. What command was run on cmd after successful RDP into other Windows machine?<a hidden class=anchor aria-hidden=true href=#the-attacker-logged-in-via-rdp-and-then-performed-lateral-movement-attacker-accessed-an-internal-network-connected-device-via-rdp-what-command-was-run-on-cmd-after-successful-rdp-into-other-windows-machine>#</a></h2><p>There are RDP Event logs</p><p>We can see RDP into 192.168.18.8 at September 8th 2022.</p><p>But how do we see what command was run on the other machine?</p><p>Found this: <a href=https://medium.com/@ronald.craft/blind-forensics-with-the-rdp-bitmap-cache-16e0c202f91c>https://medium.com/@ronald.craft/blind-forensics-with-the-rdp-bitmap-cache-16e0c202f91c</a></p><p>The tool we need to use is <code>bmc-tools.py</code></p><p>The cache file can be found in <code>C:\Users\&lt;USER>\AppData\Local\Microsoft\Terminal Server Client\Cache\</code></p><p>After generating an output with <code>python bmc-tools.py -s cache -d output -b</code></p><p>We export 1000+ small BMP images.</p><p>No tools exist on the machine to piece together the puzzle, so it’s manual work. Eventually, I found a command being run on the command prompt.</p><p>The command run on the CMD prompt is reconstructed from the RDP bitmap cache using <code>bmc-tools.py</code>, requiring manual analysis of exported BMP images.</p><h2 id=the-attacker-tried-to-download-a-tool-from-the-users-browser-in-that-second-machine-whats-the-tool-name-nameext>The attacker tried to download a tool from the user&rsquo;s browser in that second machine. What&rsquo;s the tool name? (name.ext)<a hidden class=anchor aria-hidden=true href=#the-attacker-tried-to-download-a-tool-from-the-users-browser-in-that-second-machine-whats-the-tool-name-nameext>#</a></h2><p>I answered this question, tediously, through the previous method.</p><p>The tool name is identified through manual analysis of the RDP bitmap cache images generated by <code>bmc-tools.py</code>.</p><h2 id=what-command-was-executed-which-resulted-in-privilege-escalation>What command was executed which resulted in privilege escalation?<a hidden class=anchor aria-hidden=true href=#what-command-was-executed-which-resulted-in-privilege-escalation>#</a></h2><p>When reviewing the SYSTEM event logs, there are no 4688 events, but we can see a peculiar log which registers a service.</p><p>The command to register a service is <code>cmd.exe /c echo kyvckn > \\.\pipe\kyvckn</code></p><p>Researching more on the format of this command and what it’s doing led me to this page: <a href=https://bherunda.medium.com/hunting-named-pipe-token-impersonation-abuse-573dcca36ae0>https://bherunda.medium.com/hunting-named-pipe-token-impersonation-abuse-573dcca36ae0</a></p><p>The command <code>cmd.exe /c echo kyvckn > \\.\pipe\kyvckn</code> facilitates privilege escalation through named pipe token impersonation. This technique involves creating a named pipe and using it to impersonate a higher-privileged token, often by exploiting a service or process with elevated rights. The attacker writes to the pipe (<code>kyvckn</code>), allowing them to steal or duplicate the token for unauthorized privilege elevation <a href=https://docs.microsoft.com/en-us/windows/win32/ipc/named-pipes>see details on named pipe impersonation</a>.</p><h2 id=what-framework-was-used-by-the-attacker>What framework was used by the attacker?<a hidden class=anchor aria-hidden=true href=#what-framework-was-used-by-the-attacker>#</a></h2><p>This command can be used by the Metasploit framework (Meterpreter).</p><p>The Metasploit framework, specifically the Meterpreter payload, is identified as the likely tool used, given its capability to execute such named pipe commands for privilege escalation.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://isuquo.github.io/>My blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>