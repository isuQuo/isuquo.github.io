<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>Crackme challenge #1 | My blog</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="7eRoM - 1st one challenge
Welcome to my first blog post. Today, we&rsquo;ll be attempting to crack 7eRoM&rsquo;s Crackme called &ldquo;1st one challenge&rdquo;.
When executing the app, you are prompted for a password:

The app exits afterwards.
If we debug the app in Ollydbg, we get a slightly different output after entering in the same password:

Finding the main function
When viewing this app in Ollydbg, we are greeted with the C runtime initialization (CRT) system. According to https://www.embecosm.com/appnotes/ean9/html/ch05s02.html, a few initialization steps need to be taken before calling the main function."><meta name=generator content="Hugo 0.147.8"><meta name=robots content="index, follow"><link rel=stylesheet href=/ananke/css/main.min.8d048772ae72ab11245a0e296d1f2a36d3e3dd376c6c867394d6cc659c68fc37.css><link rel=canonical href=https://isuquo.github.io/posts/crackme-1/><meta property="og:url" content="https://isuquo.github.io/posts/crackme-1/"><meta property="og:site_name" content="My blog"><meta property="og:title" content="Crackme challenge #1"><meta property="og:description" content="7eRoM - 1st one challenge Welcome to my first blog post. Today, we’ll be attempting to crack 7eRoM’s Crackme called “1st one challenge”.
When executing the app, you are prompted for a password:
The app exits afterwards.
If we debug the app in Ollydbg, we get a slightly different output after entering in the same password:
Finding the main function When viewing this app in Ollydbg, we are greeted with the C runtime initialization (CRT) system. According to https://www.embecosm.com/appnotes/ean9/html/ch05s02.html, a few initialization steps need to be taken before calling the main function."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-09-25T00:00:00+00:00"><meta property="article:modified_time" content="2019-09-25T00:00:00+00:00"><meta itemprop=name content="Crackme challenge #1"><meta itemprop=description content="7eRoM - 1st one challenge Welcome to my first blog post. Today, we’ll be attempting to crack 7eRoM’s Crackme called “1st one challenge”.
When executing the app, you are prompted for a password:
The app exits afterwards.
If we debug the app in Ollydbg, we get a slightly different output after entering in the same password:
Finding the main function When viewing this app in Ollydbg, we are greeted with the C runtime initialization (CRT) system. According to https://www.embecosm.com/appnotes/ean9/html/ch05s02.html, a few initialization steps need to be taken before calling the main function."><meta itemprop=datePublished content="2019-09-25T00:00:00+00:00"><meta itemprop=dateModified content="2019-09-25T00:00:00+00:00"><meta itemprop=wordCount content="773"><meta name=twitter:card content="summary"><meta name=twitter:title content="Crackme challenge #1"><meta name=twitter:description content="7eRoM - 1st one challenge Welcome to my first blog post. Today, we’ll be attempting to crack 7eRoM’s Crackme called “1st one challenge”.
When executing the app, you are prompted for a password:
The app exits afterwards.
If we debug the app in Ollydbg, we get a slightly different output after entering in the same password:
Finding the main function When viewing this app in Ollydbg, we are greeted with the C runtime initialization (CRT) system. According to https://www.embecosm.com/appnotes/ean9/html/ch05s02.html, a few initialization steps need to be taken before calling the main function."></head><body class="ma0 avenir bg-near-white production"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l center items-center justify-between"><a href=/ class="f3 fw2 hover-white white-90 dib no-underline">My blog</a><div class="flex-l items-center"><div class=ananke-socials></div></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l mw8 center ph3 flex-wrap justify-between"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked ttu">Posts</aside><div id=sharing class="mt3 ananke-socials"></div><h1 class="f1 athelas mt3 mb1">Crackme challenge #1</h1><time class="f6 mv4 dib tracked" datetime=2019-09-25T00:00:00Z>September 25, 2019</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><h1 id=7erom---1st-one-challenge>7eRoM - 1st one challenge</h1><p>Welcome to my first blog post. Today, we&rsquo;ll be attempting to crack 7eRoM&rsquo;s Crackme called &ldquo;1st one challenge&rdquo;.</p><p>When executing the app, you are prompted for a password:</p><p><img src=images/1.PNG alt></p><p>The app exits afterwards.</p><p>If we debug the app in Ollydbg, we get a slightly different output after entering in the same password:</p><p><img src=images/2.PNG alt></p><h2 id=finding-the-main-function>Finding the main function</h2><p>When viewing this app in Ollydbg, we are greeted with the C runtime initialization (CRT) system. According to <a href=https://www.embecosm.com/appnotes/ean9/html/ch05s02.html>https://www.embecosm.com/appnotes/ean9/html/ch05s02.html</a>, a few initialization steps need to be taken before calling the main function.</p><p>We can identify common calls made by the CRT system in order to get closer to the main function. These calls include kernel32.GetCommandLineX and kernel32.GetEnvironmentStringsX.</p><p>In the main CPU window, right click anywhere and hover over &lsquo;Search for&rsquo; and select &lsquo;All intermodular calls&rsquo;. Click on the Destination tab to sort the library calls by name. We will first take a look at kernel32.GetEnvironmentStringsW and set a breakpoint on it (F2).</p><p>When starting the app, we hit the breakpoint. We can single step from here and shortly thereafter, the CMD window asking for the password pops up. We can backtrack from here to ascertain this as our main function.</p><p>If we view the above in IDA (graph view makes it easier for us to find the main function), we can create a chart that shows us how many calls were made from the main function:</p><p><img src=images/3.PNG alt></p><p>It might be hard to see, but I renamed the function in cyan blue to &ldquo;function_before_main&rdquo;.</p><p>Another way we can find our way to the main function is utilizing the referenced strings. We find some interesting ones at that:</p><p><img src=images/4.PNG alt></p><p>We can double click the text in Ollydbg to find where it is used in memory.</p><h2 id=finding-the-correct-password>Finding the correct password</h2><p>When we call into the main function, we can see our &ldquo;password:&rdquo; string being pushed onto the stack at 0x403BA0. Before pushing the string, a jump condition is met. If the jump condition is equal to 0, we jump over our string.</p><p>We can decompile this function with Ghidra to reveal two outcomes based on this jump condition:</p><p><img src=images/5.PNG alt></p><p><img src=images/6.PNG alt></p><p>We do not take the jump, so we fall through to the else clause. We&rsquo;ll take a look at this path first.</p><p>It appears some heavy math is involved in order to get the correct password:</p><p><img src=images/7.PNG alt></p><p>We can see our &ldquo;Password is not correct&rdquo; string. I was not able to find a way to get the correct password when taking this route unless I patch the instructions, which makes it too easy.</p><p>How do we take the other path? We can obviously patch the jump condition instruction, but let&rsquo;s see what it&rsquo;s checking against first.</p><p>According to the screenshot below, we can see offset 0x18 in the FS segment register is being accessed. Offset 0x30 is accessed from there, and another offset of 0x2. This is moved into EDX and is the basis of our jump condition.</p><p><img src=images/8.PNG alt></p><p>According to <a href=https://en.wikipedia.org/wiki/Win32_Thread_Information_Block>https://en.wikipedia.org/wiki/Win32_Thread_Information_Block</a>, offset 0x18 is the linear address of the thread environment block (TEB) and offset 0x30 is the linear address of the process environment block (PEB). Offset 0x2 from the PEB points to an interesting discovery:</p><pre tabindex=0><code>struct _PEB {
    0x000 BYTE InheritedAddressSpace;
    0x001 BYTE ReadImageFileExecOptions;
    0x002 BYTE BeingDebugged;
</code></pre><p>The app is essentially detecting that we&rsquo;re using a debugger. In order to patch this, we can change the instruction from <code>AND EDX,0FF</code> to <code>MOV EDX,0</code></p><p>This way, the result from calling BeingDebugged is false, now we can move onto discovering the password.</p><p><img src=images/9.PNG alt></p><p>We see now that the app is using LoadLibraryA and GetProcAddress to use the printf function to print &ldquo;password: " to the console. I assume it&rsquo;s done this way as a means to trick the reverser into believing the other path was the way to go.</p><p>Right after we enter in our password, we can see something interesting in memory:</p><p><img src=images/10.PNG alt></p><p>Is that the password we&rsquo;re looking for? Jumping back into IDA, at address 0x403C98 the first byte of our password is compared with the first byte of &ldquo;Simple?&rdquo; (&ldquo;S&rdquo;). We will patch the instructions in Ollydbg in order to make the app think the comparisons are correct. After that, the next byte from each password are compared. Same as again, we&rsquo;ll patch the jump instruction to see where it leads us.</p><p>The first two bytes are taken off from each password and the now first bytes are being compared against each other.</p><p>After stepping through this function and making sure each check is correct, we get the following message:</p><p><img src=images/11.PNG alt></p><p>I think we know what the password is. Let&rsquo;s execute the Crackme without running the debugger and give it a go:</p><p><img src=images/12.PNG alt></p><ul class=pa0></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href=https://isuquo.github.io/>&copy; My blog 2025</a><div><div class=ananke-socials></div></div></div></footer></body></html>