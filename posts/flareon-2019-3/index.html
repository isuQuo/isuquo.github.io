<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Flare-on 2019 challenge #3 | My blog</title><meta name=keywords content><meta name=description content="Welcome to the third Flare-on 2019 challenge write up. This time we&rsquo;ll be looking at an application called FlareBear, which is also the name of the challenge.
The readme that is included reads:
We at Flare have created our own Tamagotchi pet, the flarebear. He is very fussy. Keep him alive and happy and he will give you the flag. This application is an .apk file, so we will need to download an Andorid emulator to run the application."><meta name=author content><link rel=canonical href=https://isuquo.github.io/posts/flareon-2019-3/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://isuquo.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://isuquo.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://isuquo.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://isuquo.github.io/apple-touch-icon.png><link rel=mask-icon href=https://isuquo.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Flare-on 2019 challenge #3"><meta property="og:description" content="Welcome to the third Flare-on 2019 challenge write up. This time we&rsquo;ll be looking at an application called FlareBear, which is also the name of the challenge.
The readme that is included reads:
We at Flare have created our own Tamagotchi pet, the flarebear. He is very fussy. Keep him alive and happy and he will give you the flag. This application is an .apk file, so we will need to download an Andorid emulator to run the application."><meta property="og:type" content="article"><meta property="og:url" content="https://isuquo.github.io/posts/flareon-2019-3/"><meta property="article:section" content="posts"><meta name=twitter:card content="summary"><meta name=twitter:title content="Flare-on 2019 challenge #3"><meta name=twitter:description content="Welcome to the third Flare-on 2019 challenge write up. This time we&rsquo;ll be looking at an application called FlareBear, which is also the name of the challenge.
The readme that is included reads:
We at Flare have created our own Tamagotchi pet, the flarebear. He is very fussy. Keep him alive and happy and he will give you the flag. This application is an .apk file, so we will need to download an Andorid emulator to run the application."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://isuquo.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Flare-on 2019 challenge #3","item":"https://isuquo.github.io/posts/flareon-2019-3/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Flare-on 2019 challenge #3","name":"Flare-on 2019 challenge #3","description":"Welcome to the third Flare-on 2019 challenge write up. This time we\u0026rsquo;ll be looking at an application called FlareBear, which is also the name of the challenge.\nThe readme that is included reads:\nWe at Flare have created our own Tamagotchi pet, the flarebear. He is very fussy. Keep him alive and happy and he will give you the flag. This application is an .apk file, so we will need to download an Andorid emulator to run the application.","keywords":[],"articleBody":"Welcome to the third Flare-on 2019 challenge write up. This time we’ll be looking at an application called FlareBear, which is also the name of the challenge.\nThe readme that is included reads:\nWe at Flare have created our own Tamagotchi pet, the flarebear. He is very fussy. Keep him alive and happy and he will give you the flag. This application is an .apk file, so we will need to download an Andorid emulator to run the application.\nAfter downloading BlueStacks, I imported the .apk file and started the app.\nDynamic Anlaysis: When starting Flare Bear, we get the option to create a new bear. We name our bear “1”. Once started, it appears we have three buttons we can click. One of them feeds the bear, the other button allows us to play with the bear, and the other cleans up any poo. If there is no poo, we get a prompt stating there is no poo to clean. The more we feed the bear, the more he poos.\nStatic Analysis: Since the file we are given is an .apk file, we can open it with an archive manager, such as 7-Zip. Inside it, we can see a classes.dex file. Once we extract this, we can use an application called dex2jar which will convert the file to a .jar file. We can decompile .jar files with JD-GUI (Java Decompiler).\nUsing Java Decompiler, we can see a whole host of juicy functions to set our eyes on:\nThe most interesting function we can turn our eyes too will be the “danceWithFlag” function. It appears this function loads the dancing animation resources, gets a password by calling the “getPassword” function, and decrypts the password.\nThe “getPassword” returns a string by calling “getStat” and passing the strings ‘f’, ‘p’, and ‘c’ to it.\nScrolling through the other functions, we can see “danceWithFlag” is called in the “setMood” function.\nSo it seems the return value from “isHappy” and “isEcstatic” need to be true in order for the “danceWithFlag” function to be executed.\nThe “isHappy” function doesn’t appear to be interesting. It calls the “getStat” function with ‘f’ and ‘p’ strings, which I assume ‘f’ is for feed, and ‘p’ is for play. It then calculate the return value.\nThe “isEcstatic” method is the final function called before we get the flag, so we can focus on this one.\nIt appears the function gets the state of mass, happy, and clean and compares the values to 72, 30, and 0 respectively.\nSo, how do we set these values?\nWhen looking around, I can see three functions of interest. “changeMass”, “changeHappy”, and “changeClean”.\nThere are another three functions that call the above functions, which we can use to get the numbers we require. Those functions are called “feed”, “play”, and “clean”.\nThe above is an example of what one of the three methods do. Going through each function, I have summarized how they each change the required property values.\nfeed: mass += 10 happy += 2 clean -= 1\nplay: mass -= 2 happy += 4 clean -= 1\nclean: happy -= 1 clean += 6\nSo, with the help of Python, we can develop a script to help us find out how many times we need to press each button.\nimport random\rfeed_count = 0\rplay_count = 0\rclean_count = 0\rclass Flare:\rdef __init__(self):\rself.mass = 0\rself.happy = 0\rself.clean = 0\rdef do_feed(self):\rself.mass += 10\rself.happy += 2\rself.clean -= 1\rdef do_play(self):\rself.mass -= 2\rself.happy += 4\rself.clean -= 1\r# need to call this function last\rdef do_clean(self):\rself.happy -= 1\rself.clean += 6\rif __name__ == \"__main__\":\rf = Flare()\rwhile True:\rfor i in range(random.randint(1, 20)):\rf.do_feed()\rfeed_count+=1\rfor i in range(random.randint(1, 20)):\rf.do_play()\rplay_count+=1\rfor i in range(random.randint(1, 20)):\rf.do_clean()\rclean_count+=1\rif f.mass==72 and f.happy==30 and f.clean==0:\rprint(\"Mass: {}, Happy: {}, Clean: {}\".format(f.mass, f.happy, f.clean))\rprint(feed_count, play_count, clean_count)\rbreak\relse:\rf.mass = 0\rf.happy = 0\rf.clean = 0\rfeed_count = 0\rplay_count = 0\rclean_count = 0 The output is the following:\nMass: 72, Happy: 30, Clean: 0\r8 4 2 If we click the feed button 8 times, the play button 4 times and the clean button 2 times, we reveal the flag!\n","wordCount":"712","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://isuquo.github.io/posts/flareon-2019-3/"},"publisher":{"@type":"Organization","name":"My blog","logo":{"@type":"ImageObject","url":"https://isuquo.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://isuquo.github.io accesskey=h title="My blog (Alt + H)">My blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Flare-on 2019 challenge #3</h1><div class=post-meta></div></header><div class=post-content><p>Welcome to the third Flare-on 2019 challenge write up. This time we&rsquo;ll be looking at an application called FlareBear, which is also the name of the challenge.</p><p>The readme that is included reads:</p><blockquote><p>We at Flare have created our own Tamagotchi pet, the flarebear. He is very fussy. Keep him alive and happy and he will give you the flag.
This application is an .apk file, so we will need to download an Andorid emulator to run the application.</p></blockquote><p>After downloading BlueStacks, I imported the .apk file and started the app.</p><h1 id=dynamic-anlaysis>Dynamic Anlaysis:<a hidden class=anchor aria-hidden=true href=#dynamic-anlaysis>#</a></h1><p>When starting Flare Bear, we get the option to create a new bear. We name our bear &ldquo;1&rdquo;. Once started, it appears we have three buttons we can click. One of them feeds the bear, the other button allows us to play with the bear, and the other cleans up any poo. If there is no poo, we get a prompt stating there is no poo to clean. The more we feed the bear, the more he poos.</p><h1 id=static-analysis>Static Analysis:<a hidden class=anchor aria-hidden=true href=#static-analysis>#</a></h1><p>Since the file we are given is an .apk file, we can open it with an archive manager, such as 7-Zip. Inside it, we can see a classes.dex file. Once we extract this, we can use an application called dex2jar which will convert the file to a .jar file. We can decompile .jar files with JD-GUI (Java Decompiler).</p><p>Using Java Decompiler, we can see a whole host of juicy functions to set our eyes on:</p><p><img loading=lazy src=images/1.PNG alt></p><p>The most interesting function we can turn our eyes too will be the &ldquo;danceWithFlag&rdquo; function. It appears this function loads the dancing animation resources, gets a password by calling the &ldquo;getPassword&rdquo; function, and decrypts the password.</p><p>The &ldquo;getPassword&rdquo; returns a string by calling &ldquo;getStat&rdquo; and passing the strings &lsquo;f&rsquo;, &lsquo;p&rsquo;, and &lsquo;c&rsquo; to it.</p><p>Scrolling through the other functions, we can see &ldquo;danceWithFlag&rdquo; is called in the &ldquo;setMood&rdquo; function.</p><p><img loading=lazy src=images/2.PNG alt></p><p>So it seems the return value from &ldquo;isHappy&rdquo; and &ldquo;isEcstatic&rdquo; need to be true in order for the &ldquo;danceWithFlag&rdquo; function to be executed.</p><p>The &ldquo;isHappy&rdquo; function doesn&rsquo;t appear to be interesting. It calls the &ldquo;getStat&rdquo; function with &lsquo;f&rsquo; and &lsquo;p&rsquo; strings, which I assume &lsquo;f&rsquo; is for feed, and &lsquo;p&rsquo; is for play. It then calculate the return value.</p><p>The &ldquo;isEcstatic&rdquo; method is the final function called before we get the flag, so we can focus on this one.</p><p><img loading=lazy src=images/3.PNG alt></p><p>It appears the function gets the state of mass, happy, and clean and compares the values to 72, 30, and 0 respectively.</p><p>So, how do we set these values?</p><p>When looking around, I can see three functions of interest. &ldquo;changeMass&rdquo;, &ldquo;changeHappy&rdquo;, and &ldquo;changeClean&rdquo;.</p><p>There are another three functions that call the above functions, which we can use to get the numbers we require. Those functions are called &ldquo;feed&rdquo;, &ldquo;play&rdquo;, and &ldquo;clean&rdquo;.</p><p><img loading=lazy src=images/4.PNG alt></p><p>The above is an example of what one of the three methods do. Going through each function, I have summarized how they each change the required property values.</p><p>feed:
mass += 10
happy += 2
clean -= 1</p><p>play:
mass -= 2
happy += 4
clean -= 1</p><p>clean:
happy -= 1
clean += 6</p><p>So, with the help of Python, we can develop a script to help us find out how many times we need to press each button.</p><pre tabindex=0><code>import random

feed_count = 0
play_count = 0
clean_count = 0

class Flare:
 def __init__(self):
  self.mass = 0
  self.happy = 0
  self.clean = 0

 def do_feed(self):
  self.mass += 10
  self.happy += 2
  self.clean -= 1
  
 def do_play(self):
  self.mass -= 2
  self.happy += 4
  self.clean -= 1
  
 # need to call this function last
 def do_clean(self):
  self.happy -= 1
  self.clean += 6
 
if __name__ == &#34;__main__&#34;:
 f = Flare()
 
 while True:
  for i in range(random.randint(1, 20)):
   f.do_feed()
   feed_count+=1
  for i in range(random.randint(1, 20)):
   f.do_play()
   play_count+=1
  for i in range(random.randint(1, 20)):
   f.do_clean()
   clean_count+=1
  if f.mass==72 and f.happy==30 and f.clean==0:
   print(&#34;Mass: {}, Happy: {}, Clean: {}&#34;.format(f.mass, f.happy, f.clean))
   print(feed_count, play_count, clean_count)
   break
  else:
   f.mass = 0
   f.happy = 0
   f.clean = 0
   
   feed_count = 0
   play_count = 0
   clean_count = 0
</code></pre><p>The output is the following:</p><pre tabindex=0><code>Mass: 72, Happy: 30, Clean: 0
8 4 2
</code></pre><p>If we click the feed button 8 times, the play button 4 times and the clean button 2 times, we reveal the flag!</p><p><img loading=lazy src=images/5.PNG alt></p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>