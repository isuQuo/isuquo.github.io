<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Crackme challenge #3 | My blog</title><meta name=keywords content><meta name=description content="Today we&rsquo;ll be looking at a ringzer0 challenge called &ldquo;Crack Me 1&rdquo; made by Mr.Un1k0d3r and can be found here: https://ringzer0ctf.com/challenges/9 - the challenge is worth 3 points.
The goal of the challenge is to find the flag hidden within.
When first executing the executable, we are presented with the following MessageBox:
After pressing OK, the program exits.
Static analysis: I noticed in PEView that there is a custom resource section, suggesting that their might be hidden data within:"><meta name=author content><link rel=canonical href=https://isuquo.github.io/posts/crackme-3/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://isuquo.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://isuquo.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://isuquo.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://isuquo.github.io/apple-touch-icon.png><link rel=mask-icon href=https://isuquo.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Crackme challenge #3"><meta property="og:description" content="Today we&rsquo;ll be looking at a ringzer0 challenge called &ldquo;Crack Me 1&rdquo; made by Mr.Un1k0d3r and can be found here: https://ringzer0ctf.com/challenges/9 - the challenge is worth 3 points.
The goal of the challenge is to find the flag hidden within.
When first executing the executable, we are presented with the following MessageBox:
After pressing OK, the program exits.
Static analysis: I noticed in PEView that there is a custom resource section, suggesting that their might be hidden data within:"><meta property="og:type" content="article"><meta property="og:url" content="https://isuquo.github.io/posts/crackme-3/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-11-27T00:00:00+00:00"><meta property="article:modified_time" content="2019-11-27T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Crackme challenge #3"><meta name=twitter:description content="Today we&rsquo;ll be looking at a ringzer0 challenge called &ldquo;Crack Me 1&rdquo; made by Mr.Un1k0d3r and can be found here: https://ringzer0ctf.com/challenges/9 - the challenge is worth 3 points.
The goal of the challenge is to find the flag hidden within.
When first executing the executable, we are presented with the following MessageBox:
After pressing OK, the program exits.
Static analysis: I noticed in PEView that there is a custom resource section, suggesting that their might be hidden data within:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://isuquo.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Crackme challenge #3","item":"https://isuquo.github.io/posts/crackme-3/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Crackme challenge #3","name":"Crackme challenge #3","description":"Today we\u0026rsquo;ll be looking at a ringzer0 challenge called \u0026ldquo;Crack Me 1\u0026rdquo; made by Mr.Un1k0d3r and can be found here: https://ringzer0ctf.com/challenges/9 - the challenge is worth 3 points.\nThe goal of the challenge is to find the flag hidden within.\nWhen first executing the executable, we are presented with the following MessageBox:\nAfter pressing OK, the program exits.\nStatic analysis: I noticed in PEView that there is a custom resource section, suggesting that their might be hidden data within:","keywords":[],"articleBody":"Today we’ll be looking at a ringzer0 challenge called “Crack Me 1” made by Mr.Un1k0d3r and can be found here: https://ringzer0ctf.com/challenges/9 - the challenge is worth 3 points.\nThe goal of the challenge is to find the flag hidden within.\nWhen first executing the executable, we are presented with the following MessageBox:\nAfter pressing OK, the program exits.\nStatic analysis: I noticed in PEView that there is a custom resource section, suggesting that their might be hidden data within:\nAs I suspected, I was right. We can see the first bytes represent the ASCII value “MZ”, which is the magic number for an executable. This is also confirmed by the “This program cannot be run in DOS mode” message. Almost every Windows executable has this message at the beginning of the header.\nIf we scroll further down, we can see some interesting text:\nSo far, we have deduced that there is a resource section hidden within the main PE file that also contains a PE file. We have found that a “Secret Message” may be hidden within the nested PE file.\nMoving over to IDA, we see the string that is used in the MessageBox when first executing the program. Taking a look at the imports, we see imports such as FindResourceA, LoadResource, MessageBoxA, AddAtomA, FindAtomA, and GetAtomNameA.\nWe will focus on the Resource functions for now since we found an embedded exe within the resource section of the file.\nOur next goal is to find out how the resource is being loaded and what it’s being loaded into. We might be able to see the flag using some dynamic analysis.\nLet’s hop over to Ollydbg.\nDynamic analysis: Stepping over instructions, we find ourselves in a function that has a peculiar ASCII string. The loop seems to call the “rand” function and creates a random string. Executing this loop multiple times yields different strings. As you can see below, the string returned for this one was “vnasekutos”:\nStepping a little further, we can see another string, “.dll”. Interesting.\nAfter the above function exits, we find ourselves in the function that loads our resource. As you can see below, it is calling LoadResource for the RT_RCDATA section, which matches with what we found using PEView.\nAfter stepping a little more, we can see a call to strcat which concatenates our string we found earlier to another string with the value set as our AppData\\Roaming directory.\nFinally, we can see a call to CreateFileA and WriteFile. We can now suspect that each time we execute the crack me, it creates a randomly-named dll file in our AppData\\Roaming directory, loads the PE file found in the resource section and writes the PE file to our dll file.\nLet’s take a look at that dll file.\nAs you can see, I have executed the crack me a few times already:\nWhen viewing one of these dll’s in IDA, we quickly view the imports window and select the MessageBoxA function. We’re taken here:\nThis is the same “Secret Message” string we saw earlier when viewing the resource section in PEView.\nLet’s see if we can call the DisplayMessage function to display the secret message for us:\n","wordCount":"531","inLanguage":"en","datePublished":"2019-11-27T00:00:00Z","dateModified":"2019-11-27T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://isuquo.github.io/posts/crackme-3/"},"publisher":{"@type":"Organization","name":"My blog","logo":{"@type":"ImageObject","url":"https://isuquo.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://isuquo.github.io accesskey=h title="My blog (Alt + H)">My blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Crackme challenge #3</h1><div class=post-meta><span title='2019-11-27 00:00:00 +0000 UTC'>November 27, 2019</span></div></header><div class=post-content><p>Today we&rsquo;ll be looking at a ringzer0 challenge called &ldquo;Crack Me 1&rdquo; made by Mr.Un1k0d3r and can be found here: <a href=https://ringzer0ctf.com/challenges/9>https://ringzer0ctf.com/challenges/9</a> - the challenge is worth 3 points.</p><p>The goal of the challenge is to find the flag hidden within.</p><p>When first executing the executable, we are presented with the following MessageBox:</p><p><img loading=lazy src=images/1.PNG alt></p><p>After pressing OK, the program exits.</p><h1 id=static-analysis>Static analysis:<a hidden class=anchor aria-hidden=true href=#static-analysis>#</a></h1><p>I noticed in PEView that there is a custom resource section, suggesting that their might be hidden data within:</p><p><img loading=lazy src=images/2.PNG alt></p><p>As I suspected, I was right. We can see the first bytes represent the ASCII value &ldquo;MZ&rdquo;, which is the magic number for an executable. This is also confirmed by the &ldquo;This program cannot be run in DOS mode&rdquo; message. Almost every Windows executable has this message at the beginning of the header.</p><p>If we scroll further down, we can see some interesting text:</p><p><img loading=lazy src=images/3.PNG alt></p><p>So far, we have deduced that there is a resource section hidden within the main PE file that also contains a PE file. We have found that a &ldquo;Secret Message&rdquo; may be hidden within the nested PE file.</p><p>Moving over to IDA, we see the string that is used in the MessageBox when first executing the program. Taking a look at the imports, we see imports such as FindResourceA, LoadResource, MessageBoxA, AddAtomA, FindAtomA, and GetAtomNameA.</p><p>We will focus on the Resource functions for now since we found an embedded exe within the resource section of the file.</p><p>Our next goal is to find out how the resource is being loaded and what it&rsquo;s being loaded into. We might be able to see the flag using some dynamic analysis.</p><p>Let&rsquo;s hop over to Ollydbg.</p><h1 id=dynamic-analysis>Dynamic analysis:<a hidden class=anchor aria-hidden=true href=#dynamic-analysis>#</a></h1><p>Stepping over instructions, we find ourselves in a function that has a peculiar ASCII string. The loop seems to call the &ldquo;rand&rdquo; function and creates a random string. Executing this loop multiple times yields different strings. As you can see below, the string returned for this one was &ldquo;vnasekutos&rdquo;:</p><p><img loading=lazy src=images/4.PNG alt></p><p>Stepping a little further, we can see another string, &ldquo;.dll&rdquo;. Interesting.</p><p><img loading=lazy src=images/5.PNG alt></p><p>After the above function exits, we find ourselves in the function that loads our resource. As you can see below, it is calling LoadResource for the RT_RCDATA section, which matches with what we found using PEView.</p><p><img loading=lazy src=images/6.PNG alt></p><p>After stepping a little more, we can see a call to strcat which concatenates our string we found earlier to another string with the value set as our AppData\Roaming directory.</p><p><img loading=lazy src=images/7.PNG alt></p><p>Finally, we can see a call to CreateFileA and WriteFile. We can now suspect that each time we execute the crack me, it creates a randomly-named dll file in our AppData\Roaming directory, loads the PE file found in the resource section and writes the PE file to our dll file.</p><p>Let&rsquo;s take a look at that dll file.</p><p>As you can see, I have executed the crack me a few times already:</p><p><img loading=lazy src=images/8.PNG alt></p><p>When viewing one of these dll&rsquo;s in IDA, we quickly view the imports window and select the MessageBoxA function. We&rsquo;re taken here:</p><p><img loading=lazy src=images/9.PNG alt></p><p>This is the same &ldquo;Secret Message&rdquo; string we saw earlier when viewing the resource section in PEView.</p><p>Let&rsquo;s see if we can call the DisplayMessage function to display the secret message for us:</p><p><img loading=lazy src=images/10.PNG alt></p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>