<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Flare-on 2019 challenge #3 | My blog</title><meta name=keywords content><meta name=description content="Welcome to my first Flare-on 2019 challenge write up. This challenge is called Memecat Battlestation.
The challenge comes with a readme that reads:
Welcome to the Sixth Flare-On Challenge! This is a simple game. Reverse engineer it to figure out what &ldquo;weapon codes&rdquo; you need to enter to defeat each of the two enemies and the victory screen will reveal the flag. Enter the flag here on this site to score and move on to the next level."><meta name=author content><link rel=canonical href=https://isuquo.github.io/posts/flareon-2019-1/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://isuquo.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://isuquo.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://isuquo.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://isuquo.github.io/apple-touch-icon.png><link rel=mask-icon href=https://isuquo.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Flare-on 2019 challenge #3"><meta property="og:description" content="Welcome to my first Flare-on 2019 challenge write up. This challenge is called Memecat Battlestation.
The challenge comes with a readme that reads:
Welcome to the Sixth Flare-On Challenge! This is a simple game. Reverse engineer it to figure out what &ldquo;weapon codes&rdquo; you need to enter to defeat each of the two enemies and the victory screen will reveal the flag. Enter the flag here on this site to score and move on to the next level."><meta property="og:type" content="article"><meta property="og:url" content="https://isuquo.github.io/posts/flareon-2019-1/"><meta property="article:section" content="posts"><meta name=twitter:card content="summary"><meta name=twitter:title content="Flare-on 2019 challenge #3"><meta name=twitter:description content="Welcome to my first Flare-on 2019 challenge write up. This challenge is called Memecat Battlestation.
The challenge comes with a readme that reads:
Welcome to the Sixth Flare-On Challenge! This is a simple game. Reverse engineer it to figure out what &ldquo;weapon codes&rdquo; you need to enter to defeat each of the two enemies and the victory screen will reveal the flag. Enter the flag here on this site to score and move on to the next level."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://isuquo.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Flare-on 2019 challenge #3","item":"https://isuquo.github.io/posts/flareon-2019-1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Flare-on 2019 challenge #3","name":"Flare-on 2019 challenge #3","description":"Welcome to my first Flare-on 2019 challenge write up. This challenge is called Memecat Battlestation.\nThe challenge comes with a readme that reads:\nWelcome to the Sixth Flare-On Challenge! This is a simple game. Reverse engineer it to figure out what \u0026ldquo;weapon codes\u0026rdquo; you need to enter to defeat each of the two enemies and the victory screen will reveal the flag. Enter the flag here on this site to score and move on to the next level.","keywords":[],"articleBody":"Welcome to my first Flare-on 2019 challenge write up. This challenge is called Memecat Battlestation.\nThe challenge comes with a readme that reads:\nWelcome to the Sixth Flare-On Challenge! This is a simple game. Reverse engineer it to figure out what “weapon codes” you need to enter to defeat each of the two enemies and the victory screen will reveal the flag. Enter the flag here on this site to score and move on to the next level.\nThis challenge is written in .NET. If you don’t already have a favorite .NET reverse engineering tool I recommend dnSpy If you already solved the full version of this game at our booth at BlackHat or the subsequent release on twitter, congratulations, enter the flag from the victory screen now to bypass this level. Dynamic Analysis: When first starting up the application, you are presented with the following screen:\nAfter typing in “test” as the weapon arming code, a small text message to the right of the TextBox pops up, indicating we’ve entered in the wrong code.\nThere’s not much to it, so let’s try to find the code using static analysis.\nStatic Analysis: When we load the binary in dnSpy, we see a lot of juicy functions and form controls:\nWe turn our attention to the FireButton_Click function. Immediately, we find the required code to fire the weapon:\nWe enter the “RAINBOW” code into the application and a short animation plays, before advancing onto stage 2.\nWe saw the Stage2Form class earlier. Again, we turn to a function called “FireButton_Click”, which checks if the code we entered matches the return value from a function called “isValidWeaponCode”. Let’s take a look at that function:\nWe can see it takes our entered code and converts it to a CharArray. It creates a for loop for the duration of our code length. Within the loop it copies our char array into another char array. It takes an index of our loop counter and uses that to access the array and XOR’s it with ‘A’.\nOur final char array should equal the return value.\nA quick Python script and we should be able to decode this function:\narray = [0x3, ' ', '\u0026', '$', '-', 0x1E, 0x2, ' ', '/', '/', '.', '/']\rarray2 = []\rfor char in array:\rif type(char) is str:\rresult = int(hex(ord(char)), 16) ^ int(hex(ord('A')), 16)\relse:\rresult = int(hex(char), 16) ^ int(hex(ord('A')), 16)\rarray2.append(hex(result))\rprint(array2) Entering in the result to a hex to ASCII converter and we get our final answer:\nWe enter our code into the Stage2Form TextBox and retrieve our flag:\n","wordCount":"434","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://isuquo.github.io/posts/flareon-2019-1/"},"publisher":{"@type":"Organization","name":"My blog","logo":{"@type":"ImageObject","url":"https://isuquo.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://isuquo.github.io accesskey=h title="My blog (Alt + H)">My blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Flare-on 2019 challenge #3</h1><div class=post-meta></div></header><div class=post-content><p>Welcome to my first Flare-on 2019 challenge write up. This challenge is called Memecat Battlestation.</p><p>The challenge comes with a readme that reads:</p><blockquote><p>Welcome to the Sixth Flare-On Challenge!
This is a simple game. Reverse engineer it to figure out what &ldquo;weapon codes&rdquo; you need to enter to defeat each of the two enemies and the victory screen will reveal the flag. Enter the flag here on this site to score and move on to the next level.</p><ul><li>This challenge is written in .NET. If you don&rsquo;t already have a favorite .NET reverse engineering tool I recommend dnSpy</li><li>If you already solved the full version of this game at our booth at BlackHat or the subsequent release on twitter, congratulations, enter the flag from the victory screen now to bypass this level.</li></ul></blockquote><h1 id=dynamic-analysis>Dynamic Analysis:<a hidden class=anchor aria-hidden=true href=#dynamic-analysis>#</a></h1><p>When first starting up the application, you are presented with the following screen:</p><p><img loading=lazy src=images/1.PNG alt></p><p>After typing in &ldquo;test&rdquo; as the weapon arming code, a small text message to the right of the TextBox pops up, indicating we&rsquo;ve entered in the wrong code.</p><p>There&rsquo;s not much to it, so let&rsquo;s try to find the code using static analysis.</p><h1 id=static-analysis>Static Analysis:<a hidden class=anchor aria-hidden=true href=#static-analysis>#</a></h1><p>When we load the binary in dnSpy, we see a lot of juicy functions and form controls:</p><p><img loading=lazy src=images/2.PNG alt></p><p>We turn our attention to the FireButton_Click function. Immediately, we find the required code to fire the weapon:</p><p><img loading=lazy src=images/3.PNG alt></p><p>We enter the &ldquo;RAINBOW&rdquo; code into the application and a short animation plays, before advancing onto stage 2.</p><p>We saw the Stage2Form class earlier. Again, we turn to a function called &ldquo;FireButton_Click&rdquo;, which checks if the code we entered matches the return value from a function called &ldquo;isValidWeaponCode&rdquo;. Let&rsquo;s take a look at that function:</p><p><img loading=lazy src=images/4.PNG alt></p><p>We can see it takes our entered code and converts it to a CharArray. It creates a for loop for the duration of our code length. Within the loop it copies our char array into another char array. It takes an index of our loop counter and uses that to access the array and XOR&rsquo;s it with &lsquo;A&rsquo;.</p><p>Our final char array should equal the return value.</p><p>A quick Python script and we should be able to decode this function:</p><pre tabindex=0><code>array = [0x3, &#39; &#39;, &#39;&amp;&#39;, &#39;$&#39;, &#39;-&#39;, 0x1E, 0x2, &#39; &#39;, &#39;/&#39;, &#39;/&#39;, &#39;.&#39;, &#39;/&#39;]
array2 = []

for char in array:
 if type(char) is str:
  result = int(hex(ord(char)), 16) ^ int(hex(ord(&#39;A&#39;)), 16)
 else:
  result = int(hex(char), 16) ^ int(hex(ord(&#39;A&#39;)), 16)
 array2.append(hex(result))
 
print(array2)
</code></pre><p>Entering in the result to a hex to ASCII converter and we get our final answer:</p><p><img loading=lazy src=images/5.PNG alt></p><p>We enter our code into the Stage2Form TextBox and retrieve our flag:</p><p><img loading=lazy src=images/6.PNG alt></p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>